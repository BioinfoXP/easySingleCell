% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/AutoCellType.R
\name{AutoCellType}
\alias{AutoCellType}
\title{AutoCellType}
\usage{
AutoCellType(
  input,
  tissuename,
  cellname = NULL,
  background = "",
  annotation_level = "major",
  model = "gpt-4o",
  topgenenumber = 20,
  base_url = "https://api.gpt.ge/v1",
  api_key = NULL,
  retries = 3,
  verbose = TRUE
)
}
\arguments{
\item{input}{Data frame (must contain: cluster, gene, avg_log2FC) or a named list of gene vectors.}

\item{tissuename}{Character. Tissue origin (e.g., "Liver").}

\item{cellname}{Character (Optional). Parent cell type for sub-clustering (e.g., "T cells").}

\item{background}{Character (Optional). Experimental context (e.g., "Sorafenib treated HCC").}

\item{annotation_level}{Character. "major" (lineage) or "subtype" (functional state).}

\item{model}{Character. Model name (default: "gpt-4o").}

\item{topgenenumber}{Integer. Top N markers per cluster (default: 20).}

\item{base_url}{Character. API endpoint (default: "https://api.gpt.ge/v1").}

\item{api_key}{Character. API Key (if NULL, checks OPENAI_API_KEY env var).}

\item{retries}{Integer. Max API retry attempts (default: 3).}

\item{verbose}{Logical. Print progress logs (default: TRUE).}
}
\value{
A tibble with columns: Cluster, Prediction, Confidence, Reasoning.
}
\description{
A production-ready function for cell type annotation with GPT models.

Key Features:
\enumerate{
\item \strong{Robust Parsing}: Uses Regex to extract JSON, handling cases where the model adds conversational text.
\item \strong{Context Aware}: Explicitly handles 'major' vs 'subtype' annotation levels in the prompt.
\item \strong{Quality Control}: Automatically flags mitochondrial/stress signatures.
}
}
\details{
Automated Cell Type Annotation with GPT Models (Stable Version)
}
\examples{
\dontrun{
  # --- 1. Prepare Mock Data (Simulated Liver T cell subtypes) ---
  library(tibble)
  test_markers <- tibble::tribble(
    ~cluster, ~gene,     ~avg_log2FC,
    "0",      "CD3D",    2.5,
    "0",      "CD8A",    2.3,
    "0",      "GZMB",    1.8,
    "1",      "CD3E",    2.4,
    "1",      "FOXP3",   2.5, # Treg
    "1",      "IL2RA",   1.8,
    "2",      "CD3D",    2.1,
    "2",      "PDCD1",   1.9, # Exhausted
    "2",      "HAVCR2",  1.6
  )

  # --- 2. Run Annotation ---
  # Replace with your actual API Key
  my_key <- "sk-your_actual_api_key_here"

  result <- AutoCellType(
    input = test_markers,
    tissuename = "Liver Cancer",
    cellname = "T cells",
    annotation_level = "subtype",
    background = "Hepatocellular Carcinoma immunotherapy treated",
    api_key = my_key
  )

  # --- 3. View Results ---
  print(result)
}
}
