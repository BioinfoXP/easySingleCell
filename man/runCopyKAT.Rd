% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/2.scRNA-CNA-Analysis.R
\name{runCopyKAT}
\alias{runCopyKAT}
\title{Run CopyKAT by Sample}
\usage{
runCopyKAT(
  sce,
  target_class,
  ref_classes,
  sample_col = "orig.ident",
  celltype_col = "celltype",
  output_dir = "./CopyKAT",
  overwrite = FALSE,
  min_cells = 25,
  n.cores = 20,
  KS.cut = 0.1,
  ngene.chr = 5,
  win.size = 25,
  ...
)
}
\arguments{
\item{sce}{A Seurat object.}

\item{target_class}{String. The cell type to investigate (e.g., "Epithelial").}

\item{ref_classes}{Vector of strings. The normal reference cell types (e.g., c("T_cell", "Myeloid")).}

\item{sample_col}{String. Metadata column for sample IDs. Default: "orig.ident".}

\item{celltype_col}{String. Metadata column for cell types. Default: "celltype".}

\item{output_dir}{String. Directory to save results. Default: "./CopyKAT".}

\item{overwrite}{Logical. If TRUE, re-runs existing samples. Default: FALSE.}

\item{min_cells}{Integer. Minimum cells required per sample (target + ref). Default: 25.}

\item{n.cores}{Integer. Number of cores. Default: 20.}

\item{...}{Additional arguments passed to copykat() (e.g., KS.cut, ngene.chr).}
}
\value{
Invisible data.frame of the combined results. Main output is the CSV file.
}
\description{
Runs CopyKAT on a Seurat object sample by sample.
}
\examples{
\dontrun{
  # 1. Basic Run
  # Results will be saved to "./CopyKAT/AllSamples_CopyKAT_prediction.csv"
  runCopyKAT(
    sce = sce_full,
    target_class = "Epithelial",
    ref_classes = c("T_cell", "Macrophage"),
    n.cores = 10
  )

  # 2. Advanced: Manual Annotation (How to use the output)
  # Since the function doesn't return a Seurat object, do this afterwards:

  # a) Read the generated CSV
  res <- read.csv("./CopyKAT/AllSamples_CopyKAT_prediction.csv")

  # b) Check match rate (using the auto-cleaned ID)
  print(mean(res$cleaned_id \%in\% colnames(sce_full)))

  # c) Add to Seurat (Safe Join)
  library(tidyverse)
  meta_to_add <- res \%>\%
     distinct(cleaned_id, .keep_all = TRUE) \%>\%
     column_to_rownames("cleaned_id") \%>\%
     select(copykat.pred)

  sce_full <- AddMetaData(sce_full, meta_to_add)
  DimPlot(sce_full, group.by="copykat.pred")
}
}
