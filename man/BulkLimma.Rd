% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/5.Bulk-DEG.R
\name{BulkLimma}
\alias{BulkLimma}
\title{Run Standard Limma Differential Expression Analysis (Auto-Aligned)}
\usage{
BulkLimma(
  exp_mat,
  metadata,
  group_col,
  case_group,
  control_group,
  adj_method = "BH",
  p_cutoff = 0.05,
  logfc_cutoff = 1
)
}
\arguments{
\item{exp_mat}{Normalized expression matrix (genes x samples).}

\item{metadata}{Data frame containing sample annotations. Rownames must match exp_mat colnames.}

\item{group_col}{Column name in metadata defining the groups.}

\item{case_group}{Name of the Case group.}

\item{control_group}{Name of the Control group.}

\item{adj_method}{P-value adjustment method. Default "BH".}

\item{p_cutoff}{Adjusted P-value cutoff. Default 0.05.}

\item{logfc_cutoff}{Log2 Fold Change cutoff. Default 1.}
}
\value{
A data frame with DEG results and 'change' column.
}
\description{
A robust wrapper for limma. Automatically aligns expression matrix and metadata
based on sample IDs before analysis to prevent dimension mismatch errors.
}
\examples{
\dontrun{
  # 1. 创建模拟表达矩阵 (100基因 x 6样本)
  set.seed(123)
  exp_data <- matrix(rnorm(600), nrow = 100, ncol = 6)
  colnames(exp_data) <- c("S1", "S2", "S3", "S4", "S5", "S6")
  rownames(exp_data) <- paste0("Gene", 1:100)

  # 模拟差异：让前5个基因在 S4-S6 中高表达
  exp_data[1:5, 4:6] <- exp_data[1:5, 4:6] + 3

  # 2. 创建元数据 (特意多加一个无关样本 S7，测试自动对齐功能)
  meta_data <- data.frame(
    row.names = c("S1", "S2", "S3", "S4", "S5", "S6", "S7_Unused"),
    condition = c("Ctrl", "Ctrl", "Ctrl", "Treat", "Treat", "Treat", "Treat"),
    batch = c(1, 1, 1, 2, 2, 2, 3)
  )

  # 3. 运行分析
  # 函数会自动发现 exp_data 只有 S1-S6，从而自动丢弃 meta_data 中的 S7
  deg_res <- BulkLimma(exp_mat = exp_data,
                       metadata = meta_data,
                       group_col = "condition",
                       case_group = "Treat",
                       control_group = "Ctrl")

  # 4. 查看结果
  head(deg_res)
  table(deg_res$change)
}
}
