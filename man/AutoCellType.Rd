% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/AutoCellType.R
\name{AutoCellType}
\alias{AutoCellType}
\title{AutoCellType}
\usage{
AutoCellType(
  input,
  tissuename,
  cellname = NULL,
  background = "",
  annotation_level = "major",
  model = "gpt-4o",
  topgenenumber = 20,
  base_url = "https://api.gpt.ge/v1",
  api_key = NULL,
  retries = 3,
  verbose = TRUE
)
}
\arguments{
\item{input}{Data frame (must contain columns: cluster, gene, avg_log2FC) or a named list of gene vectors.}

\item{tissuename}{Character string. Tissue origin (e.g., "Liver", "PBMC").}

\item{cellname}{Optional character string. Parent cell type (e.g., "T cells", used for sub-clustering).}

\item{background}{Optional character string. \strong{Crucial for smart annotation}. Experimental context (e.g., "Tumor microenvironment, Sorafenib resistance").}

\item{annotation_level}{Character string. "major" (lineage level) or "subtype" (specific state).}

\item{model}{Character string. Model name (default: "gpt-4o").}

\item{topgenenumber}{Integer. Number of top marker genes to use per cluster (default: 20).}

\item{base_url}{Character string. API endpoint (default: "https://api.gpt.ge/v1").}

\item{api_key}{Character string. API Key (if NULL, looks for OPENAI_API_KEY env variable).}

\item{retries}{Integer. Maximum retry attempts for API calls (default: 3).}

\item{verbose}{Logical. Whether to print progress logs (default: TRUE).}
}
\value{
A tibble with columns: Cluster, Cell_Type, Confidence, Reasoning, Annotation_Level.
}
\description{
Leverages GPT models to annotate cell types based on marker genes.
This function enforces STRICT JSON output to ensure stability and provides
"Reasoning" and "Confidence" scores to make the results interpretable.
}
\details{
Automated Cell Type Annotation with GPT Models
}
\examples{
\dontrun{
  # --- 1. Prepare Test Data (Simulated Liver T cell subtypes) ---
  library(tibble)
  test_markers <- tibble::tribble(
    ~cluster, ~gene,     ~avg_log2FC,
    "0",      "CD3D",    2.5,
    "0",      "CD8A",    2.3,
    "0",      "GZMB",    1.8,
    "1",      "CD3E",    2.4,
    "1",      "FOXP3",   2.5, # Treg marker
    "1",      "IL2RA",   1.8,
    "2",      "CD3D",    2.1,
    "2",      "PDCD1",   1.9, # Exhaustion marker
    "2",      "HAVCR2",  1.6
  )

  # --- 2. Run Annotation ---
  # Replace with your actual API Key
  my_key <- "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

  result <- AutoCellType(
    input = test_markers,
    tissuename = "Liver Cancer",
    cellname = "T cells",
    annotation_level = "subtype",
    background = "Hepatocellular Carcinoma immunotherapy treated",
    api_key = my_key
  )

  # --- 3. View Results ---
  print(result)
  # Expected output should include a 'Reasoning' column explaining
  # why Cluster 1 is Treg (based on FOXP3) etc.
}
}
